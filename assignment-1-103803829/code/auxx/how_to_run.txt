#ONE DAY DATASET SIZE
Created 2025-06-01_bme280.csv: 2914834 records for 2025-06-01
225M


# FOR ME
cd assignment-1-103803829/assignment-1-103803829/code/

go mod init dataingest
go get github.com/gocql/gocql
go get github.com/segmentio/kafka-go

# BUILDiNG CLUSTER
docker compose down -v
docker compose up --build 

docker exec -it cassandra1 cqlsh

# CHECK The cluster is ready
> SELECT data_center, host_id FROM system.peers;
> SOURCE '/init.cql';

# DELETE ALL DATABASE ROWS
> TRUNCATE mysimbdp_weather.sensor_measurements_BME280_2025_06_01;

# CHECKING RESULTS (table created dynamically based on first message's sensor_type and day)
SELECT * FROM mysimbdp_weather.sensor_measurements_BME280_2025_06_01 LIMIT 5;
SELECT COUNT(*) FROM mysimbdp_weather.sensor_measurements_BME280_2025_06_01;

# Query by hour (efficient - single partition scan):
SELECT * FROM mysimbdp_weather.sensor_measurements_BME280_2025_06_01 WHERE hour = 10 LIMIT 5;
SELECT COUNT(*) FROM mysimbdp_weather.sensor_measurements_BME280_2025_06_01 WHERE hour = 10;

# Query by hour and sensor (also efficient - filtered within partition):
SELECT * FROM mysimbdp_weather.sensor_measurements_BME280_2025_06_01 WHERE hour = 10 AND sensor_id = 113 LIMIT 5;


# TESTING
docker compose exec kafka kafka-topics --bootstrap-server localhost:9092 --list

docker compose exec kafka kafka-topics --bootstrap-server localhost:9092 \
  --delete --topic bme280-measurements

docker compose exec kafka kafka-topics --bootstrap-server localhost:9092 \
  --create --topic bme280-measurements --partitions 12 --replication-factor 1

  ORRRRRR

docker compose exec kafka kafka-topics --bootstrap-server localhost:9092 --alter --topic bme280-measurements --partitions 12

docker compose exec kafka kafka-topics --bootstrap-server localhost:9092 --describe --topic bme280-measurements


docker compose --profile workers up -d --build
docker compose logs -f producer0 producer1 producer2 producer3 producer4 producer5 producer6 producer7 producer8 producer9 producer10 producer11
docker compose logs -f consumer0 consumer1 consumer2 consumer3 consumer4 consumer5 consumer6 consumer7 consumer8 consumer9 consumer10 consumer11

# SELECT NUMBER OF CONSUMERS 
# ONLY 1 PC
docker compose --profile workers down
docker compose --profile workers up -d producer0 consumer0




CREATE KEYSPACE IF NOT EXISTS mysimbdp_weather
WITH replication = {
  'class': 'NetworkTopologyStrategy',
  'DC1': 2,
  'DC2': 1
};


-- Table created dynamically per sensor_type and day at consumer startup
-- Format: mysimbdp_weather.sensor_measurements_[sensor_type]_[day_with_underscores]
-- Example (from first message read):
CREATE TABLE IF NOT EXISTS mysimbdp_weather.sensor_measurements_BME280_2025_06_01 (
    sensor_id int,
    sensor_type text,
    location float,
    lat float,
    lon float,
    day text,
    hour int,
    timestamp text,
    pressure float,
    altitude float,
    pressure_sealevel float,
    temperature float,
    humidity float,
    PRIMARY KEY ((hour), sensor_id, timestamp)
);